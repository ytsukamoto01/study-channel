<!DOCTYPE html>
<html lang="ja">
<head>

    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
    <link rel="icon" type="image/png" sizes="64x64" href="/favicon-64.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/android-chrome-512x512.png">
    <meta name="theme-color" content="#ffffff">
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>すたでぃちゃんねる - 受験・資格試験の匿名掲示板</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/thread.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5122489446866147" crossorigin="anonymous"></script>
</head>
<!-- TODO: AdSense承認後、下記スロットIDを実際の広告ユニットIDに変更してください -->
<body data-adsense-slot-desktop-left="1234567890" data-adsense-slot-desktop-right="1234567891" data-adsense-slot-mobile-inline="1234567892">
    <header class="header">
        <div class="container">
            <div class="logo-container" onclick="window.location.href='/'">
              <div class="site-logo">
                <img src="favicon.png" alt="すたでぃちゃんねる ロゴ" width="36" height="36" style="max-width: 36px; max-height: 36px;">
              </div>
              <h1 class="logo">すたでぃちゃんねる</h1>
            </div>
            <p class="tagline">受験・資格試験の匿名掲示板</p>
            <div class="header-nav">
                <button class="nav-btn" onclick="window.location.href='/myposts'">
                    <i class="fas fa-user"></i> 投稿一覧
                </button>
                <button class="nav-btn" onclick="window.location.href='/favorites'">
                    <i class="fas fa-star"></i> お気に入り
                </button>
                <button class="new-thread-btn" onclick="window.location.href='/'">
                    <i class="fas fa-home"></i> ホーム
                </button>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <!-- ヘッダー右側のアクション群 -->
            <div class="thread-header-bar">
              <button class="back-btn" onclick="history.back()">戻る</button>
              <div class="thread-actions">
                <!-- ★ 追加：上部ボタン -->
              <button class="nav-btn comment-nav-btn" id="scrollToCommentBtn">
                <i class="fas fa-edit"></i> コメントする
              </button>
                <button class="favorite-btn" id="favoriteBtn" onclick="toggleFavorite()">
                  <i class="far fa-star"></i> お気に入り
                </button>
              </div>
            </div>
            
            <!-- スレッド詳細 -->            
            <div class="thread-detail-container">
            
                <!-- ① OP(主コメント)ブロック -->
                <article class="op-post">
                  <div class="post-header">
                    <span class="post-number">1.</span>
                    <span id="threadCategoryBadge" class="thread-category">カテゴリ</span>
                    <span id="threadSubcategoryBadge" style="display:none;"></span>
                    <span id="threadAuthor"></span>
                    <span id="threadDate" class="post-date"></span>
                  </div>
                
                  <h1 id="threadTitle" class="thread-title"></h1>
                
                  <!-- ★ 追加：主コメント内にコメント数を表示 -->
                  <div class="op-meta">
                    <span class="op-comment-count">コメント（<span id="commentCount">0</span>）</span>
                  </div>
                
                  <div id="threadHashtagsDisplay" class="thread-hashtags-display"></div>
                  <div id="threadImagesDisplay"></div>
                  <div id="threadContent" class="post-content"></div>
                  <div class="post-actions">
                    <button class="like-btn" onclick="likeThread()">
                      <i class="fas fa-heart"></i> <span id="threadLikeCount">0</span>
                    </button>
                  </div>
                </article>
            
              <!-- ② コメント一覧（全部つらなって表示） -->
              <section class="comments-section">
                <div id="commentsList"></div>
              </section>
            
              <!-- ③ コメント入力欄（最後に配置） -->
              <section class="comment-form-section" id="commentFormSection">
                <h3>コメントを投稿</h3>
                <form id="commentForm" class="comment-form">
                  <textarea id="commentContent" rows="5" placeholder="コメントを入力..."></textarea>
            
                  <!-- 画像添付機能 -->
                  <div class="form-group">
                    <label for="commentImages">画像添付</label>
                    <div class="image-upload-wrapper">
                      <input type="file" id="commentImages" accept="image/*" multiple onchange="handleImageUpload(event, 'comment')">
                      <div class="image-upload-area" onclick="document.getElementById('commentImages').click()">
                        <i class="fas fa-camera"></i>
                        <p>画像を選択またはドラッグ&ドロップ</p>
                        <small>最大5枚まで（JPG, PNG, GIF対応）</small>
                      </div>
                      <div class="image-preview-container" id="commentImagePreview"></div>
                    </div>
                  </div>
            
                    <div class="comment-author-selection">
                      <label>
                        <input type="radio" name="commentAuthorType" value="anonymous" checked>
                        匿名
                      </label>
                      <label>
                        <input type="radio" name="commentAuthorType" value="custom">
                        名前を入力
                      </label>
                      <span class="comment-custom-name" id="commentCustomNameGroup" style="display:none;">
                        <input id="commentCustomAuthorName" type="text" placeholder="表示名（任意）">
                      </span>
                    </div>

            
                  <button type="submit"><i class="fas fa-paper-plane"></i> 投稿する</button>
                </form>
              </section>
            </div>
        </div>
    </main>

    <!-- Image Modal -->
    <div class="image-modal-overlay" id="imageModal">
        <div class="image-modal-content">
            <button class="image-modal-close" onclick="closeImageModal()">&times;</button>
            <img id="modalImage" src="" alt="拡大画像">
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/ads.js"></script>
    <script src="js/reports.js"></script>
    <script src="js/thread.js"></script>
</body>
</html>
